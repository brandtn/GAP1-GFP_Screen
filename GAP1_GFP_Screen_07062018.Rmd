---
title: "Flow_Cytometry_GAP1::GFP_Screen_Tidy"
author: "Nathan Brandt"
date: "7/6/2018"
output: html_document
---

#1) Two samples in four media types analyzed on the Accuri in triplicate .
#    Strains-
#     GAP1::GFP KO Collection Pool
#     Strains have GFP fused with GAP1 and tdTomato expressed under the ACT1 promoter in the HO locus
#    Media Types-
#     SC
#     Proline Limited Media
#   Controls-
#      FY4 in Proline Limited Media
#      FY4 in SC Media
#      GFP::GAP1 HISKO in Proline Limited Media
#      GFP::GAP1 HISKO in SC Media

###This code is designed for use with the Accuri flow cytometer, which is equiped with the following lasers and filters
* Blue laser (488 nm)
  + FL1 filter = 514/20nm   GFP
  + FL3 filter = 575/25nm   YFP

* Yellow/green laser (552 nm)
  + FL2 filter = 610/20nm   mCherry, dtomato
  + FL4 filter = 586/15nm   DsRed

******

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

##Step 1: Load relevant libraries 

```{r}
# This is a function that just makes sure you have a package, or installs it for you without prompting

requireInstall <- function(packageName,isBioconductor=F) {
  if ( !try(require(packageName,character.only=T)) ) {
    print(paste0("You don't have ",packageName," accessible, ",
      "I'm gonna install it"))
    if (isBioconductor) {
      source("http://bioconductor.org/biocLite.R")                        
      biocLite(packageName)                                                 
    } else {
      install.packages("packageName", repos = "http://cran.us.r-project.org")
    }
  }
  return(1)
}

#Load libraries
requireInstall("tidyverse")
requireInstall("flowCore")
requireInstall("flowViz")
```
###Step 2: Read in all .fcs files  and a sample sheet for each set that contains columns with. Load Gates
* column1 = Well
* column2 = Strain
* column3 = Genotype
* column4 = Ploidy
* column5 = Media

```{r}
#Set working directory to the folder in which you have stored your .fcs files
#Read in all the fcs files in the directory.

path.data <-"~/Google Drive/Gresham Lab_Nathan/FlouresenceProtienAccuriRun/"

list.folders <- c("FP_Run1","FP_Run2","Christiaen_Lab_FP")

flowData <- read.flowSet(path = paste(path.data,list.folders[1],"/", sep=""), pattern=".fcs", alter.names = TRUE)

sample.sheet <- read.csv(paste(path.data,"Samplesheet_",list.folders[1],".csv", sep=""))

#Adds a sample sheet data to the pData of the flowset
pData(flowData)$Well <- sample.sheet$Well
pData(flowData)$Strain <- sample.sheet$Strain
pData(flowData)$Media <- sample.sheet$Media
pData(flowData)$Genotype <- sample.sheet$Genotype
pData(flowData)$Ploidy <- sample.sheet$Ploidy
pData(flowData)$Experiment <- sample.sheet$Experiment

for(i in 2:length(list.folders)) {
  flowData.temp <- read.flowSet(path = paste(path.data,list.folders[i],"/", sep=""), pattern=".fcs", alter.names = TRUE)

  sample.sheet <- read.csv(paste(path.data,"Samplesheet_",list.folders[i],".csv", sep=""))f

  #Adds a sample sheet data to the pData of the flowset
  pData(flowData.temp)$Well <- sample.sheet$Well
  pData(flowData.temp)$Strain <- sample.sheet$Strain
  pData(flowData.temp)$Media <- sample.sheet$Media
  pData(flowData.temp)$Genotype <- sample.sheet$Genotype
  pData(flowData.temp)$Ploidy <- sample.sheet$Ploidy
  pData(flowData.temp)$Experiment <- sample.sheet$Experiment
  
  flowData <- rbind2(flowData, flowData.temp)
}


#load the Rdata file containing the gates
#load("gates.Rdata") 
```


```{r flowSet summaries}
#Check how many cells were counted in each fcs file
fsApply(flowData, each_col, length)[1:length(flowData)]
total <- fsApply(flowData, each_col, length)[1:length(flowData)]

#Print the medians of data values for each measurement
fsApply(flowData, each_col, median)

samples.num <- length(flowData)

```


## Including Plots


```{r pressure, echo=FALSE}
plot(pressure)
```


